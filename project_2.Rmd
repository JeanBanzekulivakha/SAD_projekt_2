---
title: "Projekt 2"
author: "Banzekulivakha Zhan, Ostoja-Lniski Robert"
date: "09-06-2021"
output: html_document
---


## Struktura projektu
Struktura katalogów w projekcie przedstawia się nastepująco:

* data - katalog przechowyjący dane
* info - katalog przechowujący pliki z treścią zadania
* renv - katalog odpowiedzialny ze wirtulane środowisko języka R
* projekt_2.Rmd - główny plik (notatnik) zawierajcy kod źródłowy
* projekt_2.html - plik wynikowy projekt1.Rmd
* inne pliki konfiguracjne

## Wyamgane biblioteki i konfiguracja pakeitu *knit*
> Poniżej linkwoane bibliteki są wymagane do poprawnej "kompilacji" notatnika, stąd też wymagana jest ich wcześniejsza instalacja.

```{r setup, warning=FALSE, message=FALSE}
#library(tidyverse)
#install.packages("readxl")
#install.packages("ggplot2")


knitr::opts_chunk$set(echo = TRUE)
```

## Zadanie 1



### Przygotowanie danych
Sekcja ta definiuje funkcje odpowiedzilne za odpowiednie wczytanie danych i ich przygotowanie.

* load_data - wczytuje dane z pliku do tabeli (data frame-u)

```{r}

library("readxl")
library(ggplot2)
library(dplyr)

read_vaccination_data <- function(data_dir, data_file) {
  data_file_path <- paste0(data_dir, data_file)
  # pojawia sie komunikat new names, ktory mowi o tym, ze podczas odczytywania danych z excela
  # dodano domyslne nazwy kolumn
  df <- read_excel(data_file_path, sheet="dane", range = "AG4:BL165")
  df_dates <- read_excel(data_file_path, sheet="dane", range = "A4:A165")
  #df <- date
  colnames(df_dates) <- c("date")
  df$date <- as.Date(df_dates$date, format = '%Y-%m-%d')
  # czy masz moze inny pomysl na przyporzadkowanie nazw kolumn?
  colnames(df) <- c("dolnoslaskie_ogolem","dolnoslaskie_calkowicie",
                    "kujawskopomorskie_ogolem", "kujawskopomorskie_calkowicie",
                    "lubelskie_ogolem", "lubelskie_calkowicie",
                    "lubuskie_ogolem", "lubuskie_calkowicie",
                    "lodzkie_ogolem", "lodzkie_calkowicie",
                    "malopolskie_ogolem", "malopolskie_calkowicie",
                    "mazowieckie_ogolem", "mazowieckie_calkowicie",
                    "opolskie_ogolem", "opolskie_calkowicie",
                    "podkarpackie_ogolem", "podkarpackie_calkowicie",
                    "podlaskie_ogolem", "podlaskie_calkowicie",
                    "pomorskie_ogolem", "pomorskie_calkowicie",
                    "slaskie_ogolem", "slaskie_calkowicie",
                    "swietokrzyskie_ogolem", "swietokrzyskie_calkowicie",
                    "warminskomazurskie_ogolem", "warminskomazurskie_calkowicie",
                    "wielkopolskie_ogolem", "wielkopolskie_calkowicie",
                    "zachodniopomorskie_ogolem", "zachodniopomorskie_calkowicie",
                    "date")
  df <- df[-c(2:18, 20:21),]
  return(df)
}

read_population_data <- function(data_dir, data_file) {
  data_file_path <- paste0(data_dir, data_file)
  # pojawia sie komunikat new names, ktory mowi o tym, ze podczas odczytywania danych z excela
  # dodano domyslne nazwy kolumn
  df <- read_excel(data_file_path, sheet="TABL.1", range = "E10:E26")
  colnames(df) <- c("population")
  area_name <- c("dolnoslaskie",
                  "kujawskopomorskie",
                  "lubelskie",
                  "lubuskie",
                  "lodzkie",
                  "malopolskie",
                  "mazowieckie",
                  "opolskie",
                  "podkarpackie",
                  "podlaskie",
                  "pomorskie",
                  "slaskie",
                  "swietokrzyskie",
                  "warminskomazurskie",
                  "wielkopolskie",
                  "zachodniopomorskie")
  df["area"] <- area_name
  return(df)
}

area_to_population <- function(population_data, area_info) {
  area_name <- gsub("\\_.*","",area_info)
  area_population <- population_data$population[ population_data$area==area_name ]
  return(area_population)
}

count_vaccined_to_population <- function(population_data, vaccination_data) {
  data_column_names <- names(vaccination_data)
  data_column_names <- data_column_names[ data_column_names != 'date']
  for(i in data_column_names) {
    area_population <- area_to_population(population_data, i)
    vaccination_data[[i]] <- as.numeric(as.character(vaccination_data[[i]])) / area_population * 100
  }

  return(vaccination_data)
}

vaccination_data <- read_vaccination_data(data_dir = "data/", data_file = "covid_szczepienia.xlsx")
population_data <- read_population_data(data_dir = "data/", data_file = "ludnosc.xls")
vaccination_data <- count_vaccined_to_population(population_data, vaccination_data)

vaccination_data_total <- vaccination_data %>% select(ends_with("calkowicie"), "date")

# umiesz to zmienic, zeby nie bylo takiego copy paste?
ggplot(vaccination_data_total, aes(date)) +
  geom_line(aes(y = mazowieckie_calkowicie,color = "mazowieckie")) +
  geom_line(aes(y = lodzkie_calkowicie,color = "lodzkie")) +
  geom_line(aes(y = slaskie_calkowicie,color = "slaskie")) +
  geom_line(aes(y = lubelskie_calkowicie,color = "lubelskie")) +
  geom_line(aes(y = kujawskopomorskie_calkowicie,color = "kujawsko-pomorskie")) +
  geom_line(aes(y = warminskomazurskie_calkowicie,color = "warminsko-mazurskie")) +
  geom_line(aes(y = swietokrzyskie_calkowicie,color = "swietokrzyskie")) +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 20)) +
  scale_x_date(breaks = "1 week") +
  theme(axis.text.x = element_text(angle = 90, hjust=1)) +
  scale_x_discrete(limits= df$wojewodztwo) +
  labs(
    title = "Przebieg szczepien w poszczegolnych wojewodztwach",
    x = "data",
    y = "Procent osób zaszczepionych [%]"
  )

```
```{r}

```

a) Sprawdz, czy proces szczepien przeciw SARS-CoV-2 przebiega równie szybko we wszystkich województwach, tzn. czy liczba szczepien jest proporcjonalna do populacji tych wojewdództw.


```{r}

library("readxl")
library(ggplot2)

read_curation_data <- function(data_dir, data_file) {
  data_file_path <- paste0(data_dir, data_file)
  df <- read_excel(data_file_path, sheet="Aktualna sytuacja w Polsce", range = "B2:G18")
  colnames(df) <- c("wojewodztwo","suma_potwierdzonych","suma_zgonow","suma_wyzdrowien", "nieaktyne_przypadki", "aktywne_przypadki")
  return(df)
}

curation_data <- read_curation_data(data_dir = "data/", data_file = "covid_w_polsce.xlsx")

add_curation_efficiency_column <- function(df) {
  df <- transform(df, efektywnosc_leczenia = suma_zgonow / suma_potwierdzonych * 100)
  return(df)
}

curation_data <- add_curation_efficiency_column(curation_data)
curation_data <- curation_data[order(curation_data$efektywnosc_leczenia),]
print(curation_data)

draw_efficiency_chart <- function(df) {
  ggplot(data=df, aes(wojewodztwo, efektywnosc_leczenia)) +
    theme_bw() +
    geom_bar(stat='identity') +
    scale_y_continuous(breaks = scales::pretty_breaks(n = 20)) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
    scale_x_discrete(limits= df$wojewodztwo) +
    labs(
      title = paste("Skutecznosc leczenia wirusa Sars-cov-2 w podziale na wojewodztwa"),
      x = "",
      y = "Skutecznosc leczenia [%]"
    )
}

draw_efficiency_chart(curation_data)

```

b) Sprawdz, czy skutecznosc leczenia osób zarazonych wirusem SARS-CoV-2 jest taka sama na terenie całej Polski, tzn. czy liczba przypadków smiertelnych jest proporcjonalna do liczby osób zarazonych w poszczególnych województwach.

c) W kazdym z powyzszych przypadków wskaz ewentualnie, które województwa istotnie sie od siebie róznia pod katem rozwazanych statystyk.

## Zadanie 2

#### Zakładamy hipotezę o niezaleznosci wyniku meczu, rozumianego jako zwyciestwo, porazke lub remis gospodarzy, od kraju rozgrywek.

Dane pobrane ze strony [fcstats.com](https://pl.fcstats.com). 

*Zestaw lig do analizy:*
* Super League (Liga chińska)
* Premier League (Liga angielska)
* Serie A (Liga włoska)
* Primera Division (Liga hiszpańska)

Przygotowanie danych do analizy:

```{r}

data_compare_leagues <- data.frame(matrix(ncol = 6, nrow = 0))
colnames(data_compare_leagues) <- c("name_of_league", "1", "1%", "x", "2", "2%")
data_compare_leagues[nrow(data_compare_leagues) + 1,] = c("Super League (Liga chińska)", 102, 43, 79, 59, 25)
data_compare_leagues[nrow(data_compare_leagues) + 1,] = c("Premier League (Liga angielska)", 193, 51, 96, 91, 24)
data_compare_leagues[nrow(data_compare_leagues) + 1,] = c("Serie A (Liga włoska)", 186, 49, 102, 92, 24)
data_compare_leagues[nrow(data_compare_leagues) + 1,] = c("Primera Division (Liga hiszpańska)", 194, 51, 95, 91, 24)
data_compare_leagues

```
*Hipoteza zerowa* - wynik meczy, rozumianego jako zwyciestwo, porazke lub remis gospodarzy, *NIE ZALEŻY* od kraju rozgrywki.
*Hipoteza alternatywną* - wynik meczy, rozumianego jako zwyciestwo, porazke lub remis gospodarzy, *ZALEŻY* od kraju rozgrywki.

Sprawdzanie za pomocą funkcji chisq.test

Przy założeniu że poziom istotności jest ustalony jako 0.05 oraz przewadzonym testu (Chi-Sqyuare Test), odrzucamy hipotezę zerową i dochodzimy do wniosku, że w rzeczywistości,operając na dany lig piłkarskich, nie ma zależnośc pomiędzy wynikem mecza a krajem.

```{r}
chisq.test(data_compare_leagues$name_of_league, data_compare_leagues$`1`)
chisq.test(data_compare_leagues$name_of_league, data_compare_leagues$`2`)
chisq.test(data_compare_leagues$name_of_league, data_compare_leagues$`x`)

```
```{r}

```

